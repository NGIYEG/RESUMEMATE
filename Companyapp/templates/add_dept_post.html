{% extends 'company_base.html' %}
{% load static %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-rose-50 py-12 px-4">
  <div class="max-w-4xl mx-auto">
    
    <!-- Header -->
    <div class="text-center mb-12"> 
      <div class="flex justify-center mb-6">
        <div class="w-20 h-20 bg-gradient-to-br from-amber-500 via-orange-500 to-rose-500 rounded-3xl flex items-center justify-center shadow-2xl rotate-3">
          <i class="fa-solid fa-gears text-white text-4xl"></i>
        </div>
      </div>
      <h1 class="text-5xl font-extrabold bg-gradient-to-r from-amber-800 via-orange-700 to-rose-700 bg-clip-text text-transparent mb-3">
        System Configuration
      </h1>
      <p class="text-lg text-amber-800 font-medium">Manage departments, academic courses, and job positions</p>
    </div>

    <div class="space-y-6">

      <!-- Department Accordion -->
      <div class="bg-white/40 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden border border-white/60">
        <button type="button" 
                class="w-full px-8 py-6 flex justify-between items-center text-left bg-gradient-to-r from-amber-100/50 to-orange-100/50 border-b border-amber-200 hover:from-amber-100 hover:to-orange-100 transition"
                onclick="toggleAccordion('departmentAccordion', 'departmentIcon')">
          <div class="flex items-center space-x-3">
            <div class="w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-500 rounded-2xl flex items-center justify-center shadow-lg">
              <i class="fa-solid fa-building text-white text-xl"></i>
            </div>
            <h2 class="text-2xl font-bold text-amber-900">Add Department</h2>
          </div>
          <span id="departmentIcon" class="text-orange-600 transition-transform duration-300">
            <i class="fa-solid fa-plus text-2xl"></i>
          </span>
        </button>

        <div id="departmentAccordion" class="px-8 py-8 hidden">
          <form method="POST" class="space-y-6">
            {% csrf_token %}
            {% for field in dept_form %}
              <div>
                <label class="block text-sm font-bold text-amber-900 mb-3">{{ field.label }}</label>
                {{ field }}
                {% if field.errors %}
                  <p class="text-rose-700 text-sm mt-2 font-medium">{{ field.errors }}</p>
                {% endif %}
              </div>
            {% endfor %}
            <button type="submit" name="add_department"
                    class="w-full bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white font-bold py-4 rounded-2xl transition transform hover:scale-105 active:scale-95 shadow-xl flex items-center justify-center space-x-2">
              <i class="fa-solid fa-plus"></i>
              <span>Save Department</span>
            </button>
          </form>
        </div>
      </div>

      <!-- Academic Course Accordion -->
     <div class="bg-white/40 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden border border-white/60">
        <button type="button" 
                class="w-full px-8 py-6 flex justify-between items-center text-left bg-gradient-to-r from-purple-100/50 to-pink-100/50 border-b border-purple-200 hover:from-purple-100 hover:to-pink-100 transition"
                onclick="toggleAccordion('courseAccordion', 'courseIcon')">
          <div class="flex items-center space-x-3">
            <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center shadow-lg">
              <i class="fa-solid fa-graduation-cap text-white text-xl"></i>
            </div>
            <h2 class="text-2xl font-bold text-purple-900">Add Academic Course</h2>
          </div>
          <span id="courseIcon" class="text-purple-600 transition-transform duration-300">
            <i class="fa-solid fa-plus text-2xl"></i>
          </span>
        </button>

        <div id="courseAccordion" class="px-8 py-8 hidden">
          <form method="POST" class="space-y-6">
            {% csrf_token %}
            {% for field in course_form %}
              <div>
                <label class="block text-sm font-bold text-purple-900 mb-3">
                  {{ field.label }}
                  {% if field.field.required %}
                    <span class="text-rose-600">*</span>
                  {% endif %}
                </label>
                {{ field }}
                {% if field.help_text %}
                  <p class="text-xs text-purple-700 mt-1 font-medium">{{ field.help_text }}</p>
                {% endif %}
                {% if field.errors %}
                  <p class="text-rose-700 text-sm mt-2 font-medium">{{ field.errors }}</p>
                {% endif %}
              </div>
            {% endfor %}
            <button type="submit" name="add_course"
                    class="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-4 rounded-2xl transition transform hover:scale-105 active:scale-95 shadow-xl flex items-center justify-center space-x-2">
              <i class="fa-solid fa-plus"></i>
              <span>Save Course</span>
            </button>
          </form>

          <!-- Display Existing Courses -->
          {% if existing_courses %}
          <div class="mt-8 pt-8 border-t-2 border-purple-200">
            <h3 class="text-lg font-bold text-purple-900 mb-4">üìö Existing Academic Courses ({{ existing_courses|length }})</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              {% for course in existing_courses %}
                <div class="bg-gradient-to-r from-purple-50 to-pink-50 border-2 border-purple-200 rounded-2xl p-4 shadow-md">
                  <p class="font-bold text-purple-900">{{ course.name }}</p>
                  {% if course.code %}
                    <p class="text-xs text-purple-700 font-medium">Code: {{ course.code }}</p>
                  {% endif %}
                </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Post/Role Accordion -->
      <div class="bg-white/40 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden border border-white/60">
        <button type="button" 
                class="w-full px-8 py-6 flex justify-between items-center text-left bg-gradient-to-r from-amber-100/50 to-orange-100/50 border-b border-amber-200 hover:from-amber-100 hover:to-orange-100 transition"
                onclick="toggleAccordion('postAccordion', 'postIcon')">
          <div class="flex items-center space-x-3">
            <div class="w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-500 rounded-2xl flex items-center justify-center shadow-lg">
              <i class="fa-solid fa-briefcase text-white text-xl"></i>
            </div>
            <h2 class="text-2xl font-bold text-amber-900">Add Role / Position</h2>
          </div>
          <span id="postIcon" class="text-orange-600 transition-transform duration-300">
            <i class="fa-solid fa-plus text-2xl"></i>
          </span>
        </button>

        <div id="postAccordion" class="px-8 py-8 hidden">
          {% if post_form %}
          <form method="POST" class="space-y-6">
            {% csrf_token %}
            
            <div>
              <label class="block text-sm font-bold text-amber-900 mb-3">
                Department <span class="text-rose-600">*</span>
              </label>
              {{ post_form.department }}
              {% if post_form.department.errors %}
                <p class="text-rose-700 text-sm mt-2 font-medium">{{ post_form.department.errors }}</p>
              {% endif %}
            </div>

            <div>
              <label class="block text-sm font-bold text-amber-900 mb-3">
                Role Title <span class="text-rose-600">*</span>
              </label>
              {{ post_form.title }}
              {% if post_form.title.errors %}
                <p class="text-rose-700 text-sm mt-2 font-medium">{{ post_form.title.errors }}</p>
              {% endif %}
            </div>

            <div class="border-2 border-purple-300 rounded-2xl p-6 bg-gradient-to-br from-purple-50 to-pink-50">
              <label class="block text-sm font-bold text-purple-900 mb-3 flex items-center gap-2">
                <i class="fa-solid fa-graduation-cap text-purple-700"></i>
                üéì Required Academic Courses <span class="text-rose-600">*</span>
              </label>
              <p class="text-xs text-purple-800 mb-4 font-medium">
                Select all academic courses/programs that qualify someone for this position.
                Applicants must have at least one of these courses to be considered.
              </p>
              
              {% if existing_courses %}
                <div class="space-y-2 max-h-64 overflow-y-auto">
                  {% for course in post_form.required_courses %}
                    <label class="flex items-center p-3 hover:bg-purple-100 rounded-xl cursor-pointer transition border-2 border-purple-200 bg-white/50 backdrop-blur-sm">
                      {{ course.tag }}
                      <span class="ml-3 text-purple-900 font-bold">{{ course.choice_label }}</span>
                    </label>
                  {% endfor %}
                </div>
              {% else %}
                <div class="text-center py-8 text-rose-700 bg-rose-50 rounded-xl border border-rose-200">
                  <p class="font-bold">‚ö†Ô∏è No academic courses available.</p>
                  <p class="text-sm mt-2">Please add courses in the "Add Academic Course" section above.</p>
                </div>
              {% endif %}
              
              {% if post_form.required_courses.errors %}
                <p class="text-rose-700 text-sm mt-3 font-bold">{{ post_form.required_courses.errors }}</p>
              {% endif %}
            </div>

            <button type="submit" name="add_post"
                    class="w-full bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white font-bold py-4 rounded-2xl transition transform hover:scale-105 active:scale-95 shadow-xl flex items-center justify-center space-x-2"
                    {% if not existing_courses %}disabled{% endif %}>
              <i class="fa-solid fa-plus"></i>
              <span>Save Position</span>
            </button>
          </form>
          {% else %}
          <div class="text-center py-12">
            <div class="w-20 h-20 bg-gradient-to-br from-amber-200 to-orange-200 rounded-3xl flex items-center justify-center mx-auto mb-4">
              <i class="fa-solid fa-building text-4xl text-amber-700"></i>
            </div>
            <p class="text-amber-700 text-lg font-bold">First add a department before adding positions.</p>
          </div>
          {% endif %}

          <!-- Display Existing Posts with Courses -->
          {% if existing_posts %}
          <div class="mt-8 pt-8 border-t-2 border-amber-200">
            <h3 class="text-lg font-bold text-amber-900 mb-4">üíº Existing Positions ({{ existing_posts|length }})</h3>
            <div class="space-y-4">
              {% for post in existing_posts %}
                <div class="bg-gradient-to-r from-amber-50 to-orange-50 border-2 border-amber-300 rounded-2xl p-4 shadow-md">
                  <div class="flex items-start justify-between">
                    <div class="flex-1">
                      <p class="font-bold text-amber-900 text-lg">{{ post.title }}</p>
                      <p class="text-sm text-amber-700 font-medium">{{ post.department.name }}</p>
                      
                      {% if post.required_courses.all %}
                        <div class="mt-3">
                          <p class="text-xs font-bold text-purple-800 mb-2">Required Courses:</p>
                          <div class="flex flex-wrap gap-2">
                            {% for course in post.required_courses.all %}
                              <span class="px-3 py-1 bg-gradient-to-r from-purple-100 to-pink-100 text-purple-900 rounded-full text-xs font-bold border border-purple-300 shadow-sm">
                                {{ course.name }}
                              </span>
                            {% endfor %}
                          </div>
                        </div>
                      {% else %}
                        <p class="text-xs text-rose-700 mt-2 font-bold">‚ö†Ô∏è No courses assigned</p>
                      {% endif %}
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </div>
      </div>

    </div>

  </div>
</div>

<style>
    input, select, textarea {
        @apply w-full px-4 py-3 rounded-xl border-2 border-amber-200 bg-white/70 backdrop-blur-sm text-amber-900 font-medium placeholder-amber-400 focus:ring-2 focus:ring-orange-400 focus:border-orange-400 transition;
    }
    
    input[type="checkbox"] {
        @apply h-5 w-5 text-purple-600 focus:ring-purple-500 border-purple-300 rounded;
    }
</style>

<!-- Accordion JS -->
<script>
function toggleAccordion(contentId, iconId) {
  const content = document.getElementById(contentId);
  const icon = document.getElementById(iconId);

  if (content.classList.contains('hidden')) {
    content.classList.remove('hidden');
    icon.innerHTML = '<i class="fa-solid fa-minus text-2xl"></i>';
  } else {
    content.classList.add('hidden');
    icon.innerHTML = '<i class="fa-solid fa-plus text-2xl"></i>';
  }
}
</script>

{% endblock %}


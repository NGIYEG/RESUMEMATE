{% extends 'base.html' %}
{% load static %}

{% block content %}

<div class="min-h-screen bg-linear-to-br from-slate-50 to-slate-100 py-12 px-4">
  <div class="max-w-4xl mx-auto">
    
    <!-- Header -->
    <div class="text-center mb-12"> 
      <div class="flex justify-center mb-4">
        <svg class="w-12 h-12 text-cyan-500" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/>
        </svg>
      </div>
      <h1 class="text-4xl font-bold text-gray-800 mb-2">System Configuration</h1>
      <p class="text-lg text-gray-500">Manage departments, academic courses, and job positions</p>
    </div>

    <div class="space-y-6">

      <!-- Department Accordion -->
      <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
        <button type="button" 
                class="w-full px-8 py-6 flex justify-between items-center text-left bg-linear-to-r from-cyan-50 to-cyan-100 border-b border-cyan-200 hover:from-cyan-100 hover:to-cyan-150 transition"
                onclick="toggleAccordion('departmentAccordion', 'departmentIcon')">
          <div class="flex items-center space-x-3">
            <svg class="w-6 h-6 text-cyan-600" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-13c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-2.21 0-4 1.79-4 4h8c0-2.21-1.79-4-4-4z"/>
            </svg>
            <h2 class="text-2xl font-bold text-gray-800">Add Department</h2>
          </div>
          <span id="departmentIcon" class="text-cyan-600 transition-transform duration-300">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
          </span>
        </button>

        <div id="departmentAccordion" class="px-8 py-8 hidden">
          <form method="POST" class="space-y-6">
            {% csrf_token %}
            {% for field in dept_form %}
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-3">{{ field.label }}</label>
                {{ field }}
                {% if field.errors %}
                  <p class="text-red-600 text-sm mt-2">{{ field.errors }}</p>
                {% endif %}
              </div>
            {% endfor %}
            <button type="submit" name="add_department"
                    class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-semibold py-3 rounded-lg transition transform hover:scale-105 active:scale-95 flex items-center justify-center space-x-2">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
              </svg>
              <span>Save Department</span>
            </button>
          </form>
        </div>
      </div>

      <!-- Academic Course Accordion -->
     <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
        <button type="button" 
                class="w-full px-8 py-6 flex justify-between items-center text-left bg-linear-to-r from-cyan-50 to-cyan-100 border-b border-cyan-200 hover:from-cyan-100 hover:to-cyan-150 transition"
                onclick="toggleAccordion('courseAccordion', 'courseIcon')">
          <div class="flex items-center space-x-3">
            <svg class="w-6 h-6 text-purple-600" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 3L1 9l11 6 9-4.91V17h2V9L12 3z"/>
            </svg>
            <h2 class="text-2xl font-bold text-gray-800">Add Academic Course</h2>
          </div>
          <span id="courseIcon" class="text-purple-600 transition-transform duration-300">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
          </span>
        </button>

        <div id="courseAccordion" class="px-8 py-8 hidden">
          <form method="POST" class="space-y-6">
            {% csrf_token %}
            {% for field in course_form %}
              <div>
                <label class="block text-sm font-semibold text-gray-700 mb-3">
                  {{ field.label }}
                  {% if field.field.required %}
                    <span class="text-red-500">*</span>
                  {% endif %}
                </label>
                {{ field }}
                {% if field.help_text %}
                  <p class="text-xs text-gray-500 mt-1">{{ field.help_text }}</p>
                {% endif %}
                {% if field.errors %}
                  <p class="text-red-600 text-sm mt-2">{{ field.errors }}</p>
                {% endif %}
              </div>
            {% endfor %}
            <button type="submit" name="add_course"
                    class="w-full bg-purple-500 hover:bg-purple-600 text-white font-semibold py-3 rounded-lg transition transform hover:scale-105 active:scale-95 flex items-center justify-center space-x-2">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
              </svg>
              <span>Save Course</span>
            </button>
          </form>

          <!-- Display Existing Courses -->
          {% if existing_courses %}
          <div class="mt-8 pt-8 border-t border-purple-200">
            <h3 class="text-lg font-bold text-gray-800 mb-4">üìö Existing Academic Courses ({{ existing_courses|length }})</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              {% for course in existing_courses %}
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-3">
                  <p class="font-semibold text-purple-900">{{ course.name }}</p>
                  {% if course.code %}
                    <p class="text-xs text-purple-600">Code: {{ course.code }}</p>
                  {% endif %}
                </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Post/Role Accordion -->
      <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
        <button type="button" 
                class="w-full px-8 py-6 flex justify-between items-center text-left bg-linear-to-r from-cyan-50 to-cyan-100 border-b border-cyan-200 hover:from-cyan-100 hover:to-cyan-150 transition"
                onclick="toggleAccordion('postAccordion', 'postIcon')">
          <div class="flex items-center space-x-3">
            <svg class="w-6 h-6 text-cyan-600" fill="currentColor" viewBox="0 0 24 24">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-8-6z"/>
            </svg>
            <h2 class="text-2xl font-bold text-gray-800">Add Role / Position</h2>
          </div>
          <span id="postIcon" class="text-cyan-600 transition-transform duration-300">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
          </span>
        </button>

        <div id="postAccordion" class="px-8 py-8 hidden">
          {% if post_form %}
          <form method="POST" class="space-y-6">
            {% csrf_token %}
            
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-3">
                Department <span class="text-red-500">*</span>
              </label>
              {{ post_form.department }}
              {% if post_form.department.errors %}
                <p class="text-red-600 text-sm mt-2">{{ post_form.department.errors }}</p>
              {% endif %}
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-3">
                Role Title <span class="text-red-500">*</span>
              </label>
              {{ post_form.title }}
              {% if post_form.title.errors %}
                <p class="text-red-600 text-sm mt-2">{{ post_form.title.errors }}</p>
              {% endif %}
            </div>

            <div class="border-2 border-purple-200 rounded-lg p-6 bg-purple-50">
              <label class="block text-sm font-bold text-gray-800 mb-3">
                üéì Required Academic Courses <span class="text-red-500">*</span>
              </label>
              <p class="text-xs text-gray-600 mb-4">
                Select all academic courses/programs that qualify someone for this position.
                Applicants must have at least one of these courses to be considered.
              </p>
              
              {% if existing_courses %}
                <div class="space-y-2 max-h-64 overflow-y-auto">
                  {% for course in post_form.required_courses %}
                    <label class="flex items-center p-3 hover:bg-purple-100 rounded-lg cursor-pointer transition">
                      {{ course.tag }}
                      <span class="ml-2 text-gray-700">{{ course.choice_label }}</span>
                    </label>
                  {% endfor %}
                </div>
              {% else %}
                <div class="text-center py-8 text-gray-500">
                  <p>‚ö†Ô∏è No academic courses available.</p>
                  <p class="text-sm mt-2">Please add courses in the "Add Academic Course" section above.</p>
                </div>
              {% endif %}
              
              {% if post_form.required_courses.errors %}
                <p class="text-red-600 text-sm mt-3 font-semibold">{{ post_form.required_courses.errors }}</p>
              {% endif %}
            </div>

            <button type="submit" name="add_post"
                    class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-semibold py-3 rounded-lg transition transform hover:scale-105 active:scale-95 flex items-center justify-center space-x-2"
                    {% if not existing_courses %}disabled{% endif %}>
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
              </svg>
              <span>Save Position</span>
            </button>
          </form>
          {% else %}
          <div class="text-center py-12">
            <svg class="w-16 h-16 text-cyan-300 mx-auto mb-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-8-6z"/>
            </svg>
            <p class="text-gray-400 text-lg font-medium">First add a department before adding positions.</p>
          </div>
          {% endif %}

          <!-- Display Existing Posts with Courses -->
          {% if existing_posts %}
          <div class="mt-8 pt-8 border-t border-gray-200">
            <h3 class="text-lg font-bold text-gray-800 mb-4">üíº Existing Positions ({{ existing_posts|length }})</h3>
            <div class="space-y-4">
              {% for post in existing_posts %}
                <div class="bg-linear-to-r from-cyan-50 to-blue-50 border border-cyan-200 rounded-lg p-4">
                  <div class="flex items-start justify-between">
                    <div class="flex-1">
                      <p class="font-bold text-gray-900">{{ post.title }}</p>
                      <p class="text-sm text-gray-600">{{ post.department.name }}</p>
                      
                      {% if post.required_courses.all %}
                        <div class="mt-3">
                          <p class="text-xs font-semibold text-purple-700 mb-2">Required Courses:</p>
                          <div class="flex flex-wrap gap-2">
                            {% for course in post.required_courses.all %}
                              <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-medium border border-purple-300">
                                {{ course.name }}
                              </span>
                            {% endfor %}
                          </div>
                        </div>
                      {% else %}
                        <p class="text-xs text-red-500 mt-2">‚ö†Ô∏è No courses assigned</p>
                      {% endif %}
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </div>
      </div>

    </div>

 

  </div>
</div>

<!-- Accordion JS -->
<script>
function toggleAccordion(contentId, iconId) {
  const content = document.getElementById(contentId);
  const icon = document.getElementById(iconId);

  content.classList.toggle('hidden');
  icon.classList.toggle('rotate-180');
}

// Auto-style Django form fields
document.addEventListener('DOMContentLoaded', function() {
  // Style all input, select, and textarea fields
  document.querySelectorAll('input:not([type="submit"]):not([type="checkbox"]), select, textarea').forEach(field => {
    field.classList.add('w-full', 'px-4', 'py-3', 'rounded-lg', 'border', 'border-gray-300', 
                        'focus:ring-2', 'focus:ring-cyan-500', 'focus:border-transparent', 
                        'transition', 'bg-white');
  });
});
</script>

{% endblock %}